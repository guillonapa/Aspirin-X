<%= form_with(model: assignment, local: true, authenticity_token: true) do |form| %>
  <% if assignment.errors.any? %>
    <div id="error_explanation">
      <div class="alert alert-danger" role="alert">
        <h2><%= pluralize(assignment.errors.count, "error") %> prohibited this assignment from being saved:</h2>
        <ul>
        <% assignment.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
        </ul>
      </div>
    </div>
  <% end %>

  <div class="row" style="margin-left: 0; margin-right: 0">
    <div class="col-lg-5 assignment-details">
      <div class="container">
        <h3 style="padding-top:20px">New/Edit Assignment</small></h3>
        <hr/>
        <%= form.hidden_field :course_id, value: params['course_id'] %>
        <dl class="row">
          <dt class="col-sm-3">Name</dt>
          <dd class="col-sm-9">
            <%= form.text_field :name, id: :assignment_name, class: "form-control" %>
          </dd>
          <dt class="col-sm-3">Instructions</dt>
          <dd class="col-sm-9">
            <%= form.text_area :instructions, id: :assignment_instructions, class: "form-control", rows: "2" %>
          </dd>
          <dt class="col-sm-3">Due Date</dt>
          <dd class="col-sm-9">
            <%= form.datetime_select :due_date, id: :assignment_due_date, class: "form-control" %>
          </dd>
        </dl>
        <hr/>
      </div>
    </div>
    <div class="col-lg-7" style="padding-right: 0">
      <%= form.text_area :template, id: :assignment_template %>
      <%= token_tag(nil) %>
      <pre id="editor" style="margin-bottom: 0px" class="editor-div"></pre>
      <nav class="navbar navbar-light bg-light">
        <div class="row justify-content-between">
          <div class="col-sm-9">
            <select class="form-control" id="select1">
              <option>Java</option>
              <option>Ruby</option>
              <option>Python</option>
            </select>
          </div>
          <div class="col-sm-3 ml-auto">
            <%= form.submit "Save", class: "btn btn-success ml-auto" %>
          </div>
        </div>
      </nav>
    </div>
  </div>

  <script>
    var editor = ace.edit("editor");
    var input = $('textarea[id="assignment_template"]').hide();
    console.log(input.val());
    editor.setTheme("ace/theme/xcode");
    editor.getSession().setUseSoftTabs(false);
    editor.getSession().setMode("ace/mode/java");
    editor.setShowPrintMargin(false);
    editor.setOptions({fontSize: "14px"});
    editor.setValue("");
    <% if !@assignment.template.inspect %>
      editor.setValue("<%= @assignment.template.inspect[1..-2] %>", 1);
    <% end %>
    editor.getSession().on('change', function() {
      input.val(editor.getSession().getValue());
      console.log(input.val());
    });
/*
    setInterval(autosave, 5000);

    function autosave() {
      $.ajax({
        type: 'PATCH',
        url: '/assignments/<%= @assignment.id %>',
        data: $('form').serialize(),
        dataType: 'script',
        success: function(data) {
          console.log(data);
        }
      });
    }*/
  </script>
<% end %>
